<template>
    <template if:true={showComp}>
        <template if:true={isLoaded}>
            <lightning-spinner alternative-text="Loading..."></lightning-spinner>
        </template>
        <lightning-card title="NCR Payment Processing" icon-name="custom:custom16">
            
            <!--Request Pricing Button and Approve button logic-->
            <div class="slds-grid slds-wrap">               
                <!-- Request PRicing, Rate Review, More Info buttons-->
                <template  if:false={showAppoveButton}>
                <div class="slds-col">
                    <div class="slds-size_1-of-1 slds-p-around_x-small">
                        <!--Enable Pricing Req Button-->
                        <span>    
                        <!--if Show Rate is False and enable Req Pricing is true-->                   
                        <template if:false={showRateReviewbtn}>
                            <template if:true={enableReqPricingbtn}>                          
                                <lightning-button
                                variant="brand"
                                label="Request Pricing Review"
                                icon-name="utility:contact_request"
                                icon-position="right"
                                onclick={requestPricingReview} style="height: 40px;width: 389px;"
                                class="slds-m-left_x-small"></lightning-button>
                            </template>
                        </template>
                        <!-- Rate Review Button-->
                        
                        <template if:true={showRateReviewbtn}>
                            <!--When both Show and enable Rate Review-->
                            <template if:false={disableRateReviewbtn}>                            
                            <lightning-button
                            variant="brand"
                            label="Request Rate Review"
                            icon-name="utility:contact_request"
                            icon-position="right"
                            onclick={captureRateReviewDetailFn} style="height: 40px;width: 389px;"
                            class="slds-m-left_x-small"></lightning-button>
                            </template>
                            <!--When  Show Enabled and disabled Rate Review-->
                            <template if:true={disableRateReviewbtn}>                         
                                <lightning-button
                                variant="brand"
                                label="Request Rate Review"
                                icon-name="utility:contact_request"
                                icon-position="right"
                                disabled=""
                                style="height: 40px;width: 389px;"
                                class="slds-m-left_x-small"></lightning-button>
                                </template>
                        </template>                       
                        <template if:true={showWithdrawalbtn}>
                            <div class="slds-float_right  slds-p-around_x-small">                       
                                <lightning-icon
                                    icon-name="action:recall"
                                    variant="brand"
                                    size="x-small" title="Withdraw Pricing Review"
                                    icon-class="slds-m-around_small" onclick={requestWithdrawalConfirmation}>
                                </lightning-icon>                             
                            </div>
                        </template>
                        <!--disable Pricing Req button-->
                        <!--When Show Rate Review False and enable Pricing Request is false disable Request button-->
                        <template if:false={showRateReviewbtn}>   
                            <template if:false={enableReqPricingbtn}>
                                <lightning-button
                                    variant="brand"
                                    label="Request Pricing Review"
                                    icon-name="utility:contact_request"
                                    icon-position="right"
                                    disabled="" style="height: 40px;width: 389px;"
                                    class="slds-m-left_x-small">
                                </lightning-button>
                            </template>
                        </template>
                        </span>       
                        
                        <template if:true={showPricingFillMessage}>
                            <p class="slds-p-left_small" style="color:red">
                                <b>Please input the fields for Amount Per Volume, Amount Per Transaction, Annual Transactions and Annual Volume on the Add Products or Product Schedule page.</b>
                            </p><br/>
                        </template>
                        <template if:true={showRecomendation}>
                            <p class="slds-p-left_small" style="color: #54698d">
                                <lightning-icon
                            icon-name="utility:info"
                            size="x-small"
                            alternative-text="Indicates approval"></lightning-icon>
                        Please upload necessary documentation in the <b>File</b> section before requesting a review.
                        </p>
                        </template>
                        
                        <!-- Shows message only when validation fails -->
                        <div class="slds-p-left_small" style="color: red">
                            <b>  {disRequestbtnMsg}</b>
                        </div>
                        <div class="slds-m-around_none">
                            <p class="slds-p-left_small" >
                                <b>{pricingApprover}</b>
                            </p>
                        </div>
                    
                    
                    </div>
                    
                </div>
                <template if:true={showMoreInfoProvided}>                         
                    <lightning-button
                    variant="brand"
                    label="Confirm Information Provided"
                    icon-name="utility:contact_request"
                    icon-position="right"
                    onclick={updateMoreInfoProvided} style="height: 40px;width: 389px;"
                    class="slds-m-left_x-small"></lightning-button>
                    </template>
                </template>
                <!--Show Approve Button-->
                <div class="slds-col slds-size_1-of-1 slds-p-around_x-small">
                    <template  if:true={showAppoveButton}>
                        <template if:true={showPricingApprove}>
                            <lightning-button
                            variant="brand"
                            label="Approve Pricing"
                            icon-name="utility:contact_request"
                            icon-position="right"
                            style="height: 40px;width: 389px;"
                            onclick={approvePricing}
                             class="slds-m-left_x-small"></lightning-button>
                             
                            <lightning-button
                            variant="destructive"
                            label="Reject Pricing"
                            icon-name="utility:contact_request"
                            icon-position="right"
                            style="height: 40px;width: 389px;"
                            onclick={captureRejectDetailFn}
                            class="slds-m-left_x-small"></lightning-button>
                        </template>
                        <template if:false={showPricingApprove}>
                            <lightning-button variant="brand" label="Approve Pricing"
                            icon-name="utility:contact_request"
                            icon-position="right"
                            style="height: 40px;width: 389px;"
                             disabled=""
                             class="slds-m-left_x-small"></lightning-button>
                             
                            <lightning-button variant="brand" label="Reject Pricing"
                            icon-name="utility:contact_request"
                             icon-position="right"
                            style="height: 40px;width: 389px;"
                            disabled=""
                            class="slds-m-left_x-small"></lightning-button>
                        </template>
                        <div class="slds-m-around_none">
                            <p class="slds-p-left_small" >
                                <b>{pricingApprover}</b>
                            </p>
                        </div>
                        <template if:true={approveError}>
                            <template if:true={approveSuggestion}>
                                <p class="slds-p-left_small" style="color: #54698d">
                                    <b>
                                        <lightning-icon
                                  icon-name="utility:info"
                                  size="x-small"
                                  alternative-text="Indicates approval"></lightning-icon>
                               {approvErrorMsg}
                            
                                    </b>
                                </p>
                            </template>
                            <template if:false={approveSuggestion}>
                                <p class="slds-p-left_small" style="color: red">
                                    <b>
                                        <lightning-icon
                                  icon-name="standard:first_non_empty"
                                  size="x-small"
                                  alternative-text="Indicates approval"></lightning-icon>
                               {approvErrorMsg}
                            
                                    </b>
                                </p>
                            </template>
                        </template>
                        <!-- Request More Info -->
                        <template if:true={showMoreInfoRequestbtn}>                           
                            <template if:false={disableMoreInfoRequestbtn}>
                                <lightning-button
                                variant="brand"
                                label="Request More Information"
                                icon-position="right"
                                onclick={captureMoreInfoDetailFn} style="height: 40px;width: 389px;"
                                class="slds-m-left_x-small"></lightning-button>
                            </template>
                            <template if:true={disableMoreInfoRequestbtn}>
                                <lightning-button
                                variant="brand"
                                label="Request More Information"
                                icon-position="right"
                                disabled=""
                                 style="height: 40px;width: 389px;"
                                class="slds-m-left_x-small"></lightning-button>
                            </template>
                        </template>
                    </template>
                </div>
                <!--Approver details displayed if available-->
            </div>
            <!--Generate Button Logic on COMP-->
            <div class="slds-col slds-size_1-of-1">
                <!--Show Generate Button-->
                <template  if:false={showAppoveButton}>
                    <div class="slds-col slds-size_1-of-1" >
                        <span>
                            <template if:true={enableSendAppbtn}>
                                <lightning-button variant="brand" label="Generate Payments Application" onclick={handlePaymentApplication} class="slds-m-left_x-small"></lightning-button>
                            </template>
                            <template if:false={enableSendAppbtn}>
                                <lightning-button variant="brand" label="Generate Payments Application"  class="slds-m-left_x-small" disabled=""></lightning-button>
                            </template>
                        </span>
                    </div>
                </template>
                <!--show disable message-->
                <template  if:false={showAppoveButton}>
                    <div class="slds-col slds-size_1-of-1" >
                        <template if:false={enableSendAppbtn}>
                            <p class="slds-p-left_small" style="color: red">
                                <b>
                                    <lightning-icon
                               icon-name="standard:first_non_empty"
                               size="x-small"
                               alternative-text="Indicates approval"></lightning-icon>
                            {disGnrtebtnMsg}
                         
                                </b>
                            </p>
                        </template>
                        <template if:true={enableSendAppbtn}>
                            <p class="slds-p-left_small" style="color: green">
                                <b>
                                    <lightning-icon
                               icon-name="standard:task2"
                               size="x-small"
                               alternative-text="Indicates approval"></lightning-icon>
                            {disGnrtebtnMsg}
                         
                                </b>
                            </p>
                        </template>
                    </div>
                </template>
            </div>
            <!--code added by pk185150-->

            <br>

            <!--eba-sf2024-->
            <template if:true = {swt}>
            <div class="slds-col slds-size_1-of-1">
                <!--Show Withdraw Button-->
                <template  if:false={showAppoveButton}>
                    <div class="slds-col slds-size_1-of-1" >
                        <span>
                            <template if:true={enableWithAppbtn1}>
                                <lightning-button variant="brand" label="Withdraw Payments Application" onclick={openModal} class="slds-m-left_x-small"></lightning-button>
                            </template>
                            <template if:false={enableWithAppbtn1}>
                                <lightning-button variant="brand" label="Withdraw Payments Application"  class="slds-m-left_x-small" disabled=""></lightning-button>
                            </template>
                        </span>
                    </div>
                </template>
                <!--show disable message-->
                <!--<template  if:false={showAppoveButton}>
                    <div class="slds-col slds-size_1-of-1" >
                        <template if:false={enableSendAppbtn1}>
                            <p class="slds-p-left_small" style="color: red">
                                <b>
                                    <lightning-icon
                               icon-name="standard:first_non_empty"
                               size="x-small"
                               alternative-text="Indicates approval"></lightning-icon>
                            {disGnrtebtnMsg}
                         
                                </b>
                            </p>
                        </template>
                        <template if:true={enableSendAppbtn1}>
                            <p class="slds-p-left_small" style="color: green">
                                <b>
                                    <lightning-icon
                               icon-name="standard:task2"
                               size="x-small"
                               alternative-text="Indicates approval"></lightning-icon>
                            {disGnrtebtnMsg}
                         
                                </b>
                            </p>
                        </template>
                    </div>
                </template>-->
            </div>
        </template>

             






        </lightning-card>
    </template>
    <!--Withdraw Confirmation-->
    <template if:true={withdrawalConfirmation}>
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_small">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                            onclick={requestWithdrawalCancel} title="Close">
                            <lightning-icon icon-name="utility:close" alternative-text="close"
                                                size="small" >
                                            </lightning-icon>
                        </button>
                        <h3 class="slds-section-title--divider slds-text-title_bold slds-text-color_success">Withdraw Pricing Review Confirmation.:</h3>
                
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="Confirmation-Modal">
                    <h3 class="slds-text-title_bold slds-align_absolute-center">Please confirm that you want to continue with Pricing Review Withdrawal.</h3> 
                    </div>
                    <footer class="slds-modal__footer">
                        <button class="slds-button slds-button_brand" onclick={requestWithdrawal}>Confirm</button>
                        <button class="slds-button slds-button_neutral" onclick={requestWithdrawalCancel}>Cancel</button>
                    </footer>
                </div>
                </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
    </template>


    <!--eba-sf2024-->
    <!--Capture Withdrawing Payments Application Info-->
    <template if:true={isModalOpen}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <!--<header class="slds-modal__header">
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeModal}>
                        <lightning-icon icon-name="utility:close"
                            alternative-text="close"
                            variant="inverse"
                            size="small" ></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <h2 class="slds-text-heading_medium slds-hyphenate">Enter The Reason For Withdrawing Payments Application</h2>
                </header>-->
                <template if:true={isModalLoaded}>
                    <lightning-spinner alternative-text="Loading..."></lightning-spinner>
                </template>
                <div class="slds-modal__content slds-p-around_medium" >
                    <!--<lightning-textarea name="input7" required value=""  label="Required textarea field with a maximum length of 140 characters" maxlength="140" message-when-too-long="A maximum of 140 characters are allowed in a tweet." message-when-value-missing="An empty tweet cannot be posted." ></lightning-textarea>-->
                    <lightning-textarea name="WithdrawnReason" label = "Please Enter The Reason For Withdrawing Payments Application" required value={msgValue}  onchange={handleMsgChange} message-when-value-missing="Enter the reason for Withdrawing Payments Application" ></lightning-textarea>
                    
                </div>
                
                <footer class="slds-modal__footer">
                    <button class="slds-button slds-button_neutral" onclick={closeModal} title="Cancel">Cancel</button>
                    <button class="slds-button slds-button_brand" onclick={handleWithPayApp} title="OK">OK</button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
        
    </template>
    
    
        

    <!--Capture More Info-->
    <template if:true={captureMoreInfoDetail}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
            aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_small">
            <div class="slds-modal__container">
                <header class="slds-modal__header">
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                        onclick={requestMoreInfoCancel} title="Close">
                        <lightning-icon icon-name="utility:close" alternative-text="close"
                                                size="small" >
                                            </lightning-icon>
                    </button>                     
                <!---->
                <h3 class="slds-section-title--divider slds-text-title_bold slds-text-color_success">Please provide comment for Rejecting the request:</h3>
                
            </header>
            <div class="slds-modal__content slds-p-around_medium" id="Confirmation-moreinfo-Modal">
                <div class="slds-p-bottom_large slds-p-left_large" style="width:600px">
                    <lightning-record-edit-form object-api-name="Opportunity" record-id={recordId} onsuccess={handleMoreInfo} onsubmit={requestMoreInfo}>
                        <lightning-messages></lightning-messages>                       
                            <lightning-input-field field-name="Pricing_More_Info_Reason__c" required>
                                </lightning-input-field>
                                <lightning-input-field field-name="Pricing_Team_Comments__c" required>
                                </lightning-input-field>
                            <div class="slds-m-top_medium slds-float_right">
                                <lightning-button class="slds-m-top_small slds-m-around_medium" label="Cancel" onclick={requestMoreInfoCancel}></lightning-button>
                                <lightning-button class="slds-m-top_small slds-m-around_medium" variant="brand" type="submit" label="Request More Info" ></lightning-button>
                            </div>                                
                    </lightning-record-edit-form>
                    </div>
            </div>                
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
</template>
<!-- Capture Reject Reason-->
<template if:true={captureRejectComments}>
    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
        aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_small">
        <div class="slds-modal__container">
            <header class="slds-modal__header">
                <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                    onclick={requestRejectCancel} title="Close">
                    <lightning-icon icon-name="utility:close" alternative-text="close"
                                                size="small" >
                                            </lightning-icon>
                </button>             
            <h3 class="slds-section-title--divider slds-text-title_bold slds-text-color_success">Please provide comment for Rejecting the request:</h3>
                
            </header>
            <div class="slds-modal__content slds-p-around_medium" id="Confirmation-reject-Modal">
                <div class="slds-p-bottom_large slds-p-left_large" style="width:600px">
                    <lightning-record-edit-form object-api-name="Opportunity" record-id={recordId} onsuccess={handleReject} onsubmit={requestReject}>
                        <lightning-messages></lightning-messages>                       
                            <lightning-input-field field-name="Pricing_Reject_Reason_Comments__c" required> 
                            </lightning-input-field>
                            <div class="slds-m-top_medium slds-float_right">
                                <lightning-button class="slds-m-top_small slds-m-around_medium" label="Cancel" onclick={requestRejectCancel}></lightning-button>
                                <lightning-button class="slds-m-top_small slds-m-around_medium" variant="brand" type="submit" label="Reject" ></lightning-button>
                            </div>                                
                    </lightning-record-edit-form>
                    </div>
            </div>                    
        </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
</template>
<!-- Capture Rate Review Reason-->
<template if:true={captureRateReviewComments}>
    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
        aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_small">
        <div class="slds-modal__container">
            <header class="slds-modal__header">
                <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                    onclick={requestRateReviewCancel} title="Close">
                    <lightning-icon icon-name="utility:close" alternative-text="close"
                                                size="small" >
                                            </lightning-icon>
                </button>
                <h3 class="slds-section-title--divider slds-text-title_bold slds-text-color_success">Please provide comment specifying reason for Requesting a Rate Review:</h3>
                
            </header>
            <div class="slds-modal__content slds-p-around_medium" id="Confirmation-ratereview-Modal">
                <div class="slds-p-bottom_large slds-p-left_large" style="width:600px">
                    <lightning-record-edit-form object-api-name="Opportunity" record-id={recordId} onsuccess={handleRateReview} onsubmit={requestRateReview}>
                        <lightning-messages></lightning-messages>                       
                            <lightning-input-field field-name="Pricing_Rate_Review_Comments__c" required> 
                            </lightning-input-field>
                            <div class="slds-m-top_medium slds-float_right">
                                <lightning-button class="slds-m-top_small slds-m-around_medium" label="Cancel" onclick={requestRateReviewCancel}></lightning-button>
                                <lightning-button class="slds-m-top_small slds-m-around_medium" variant="brand" type="submit" label="Request Rate Review" ></lightning-button>
                            </div>                                
                    </lightning-record-edit-form>
                    </div>
            </div>                
        </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
</template>
    <template if:false={showReviewPage}>
        
        <template if:true={showModel}>
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                            onclick={closeModel} title="Close">
                            <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#close"></use>
                            </svg>
                            <span class="slds-assist    ive-text">Close</span> 
                        </button>
                        <template if:true={totalSites}>
                            <h2 id="modal-heading-011"
                                class="slds-modal__title slds-hyphenate slds-text-heading_medium slds-text-color_success">
                                Total Number of Available Sites : {totalAvlSites}</h2>
                            <h2 id="modal-heading-01"
                                class="slds-modal__title slds-hyphenate slds-text-heading_medium slds-text-color_success">
                                Total Number of Displayed Sites : {totalSites}</h2>
                        </template>
                        <template if:true={isSiteSearched}>
                            <h2 id="modal-heading-02"
                                class="slds-modal__title slds-hyphenate slds-text-heading_medium slds-text-color_success">
                                Total Number of Searched Sites : {totalSeachedSite}</h2>
                        </template>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                        <template if:false={showReviewPage}>
                            <div class="slds-box">
                                <label for="FieldSelect" class="slds-form-element__label slds-no-flex">
                                    <abbr title="required" class="slds-required">*</abbr>
                                    Select Payment Assignee
                                </label>
                                <select class="slds-select" name = "optionSelect" onchange={ConchangeHandler} >
                                    <option value="">None</option>
                                    <template for:each={ConArray} for:item="acc" key={index}>
                                        <option key={index} value={acc.ConId}>{acc.ConName}</option>
                                    </template> 
                                </select> 
                                
                                <br/>     
                                <div class="slds-grid">
                                    <div class="slds-col slds-size_1-of-1">      
                                    
                                      <div><b>Contact Name:</b> &nbsp; {selectedContact.Name} </div>               
                                      <div><b>Contact Email:</b> &nbsp; {selectedContact.Email} </div>
                                      <div><b>Contact Phone:</b> &nbsp; {selectedContact.Phone} </div>
                                    </div>    
                                </div>
                            </div>
                            
                            <template if:true={toggleSpinner}>
                                <lightning-spinner alternative-text="Loading" size="small"></lightning-spinner>
                            </template>
                        </template>   
                        
                        <div class="slds-m-bottom_small">
                            <span>
                                <lightning-input type="search" value={sVal} placeholder="Search Site by Name "
                                    style="margin-bottom: 6px" onchange={updateSeachKey}></lightning-input>
                            </span>
                        </div>
                        <h2 class="slds-text-heading_medium slds-text-color_success">Please Select Sites :</h2>
                        <template if:false={isSiteSearched} for:each={billingAccounts} for:item="site"
                            for:index="index">
                            <div class="slds-grid slds-wrap slds-border_top" key={site.billingSite.Id}>
                                <div class="slds-col slds-size_1-of-12 slds-p-top_small">
                                    <template if:true={site.isAdded}>
                                        <span>
                                            <lightning-icon icon-name="action:approval" alternative-text="approve"
                                                size="small" onclick={addSites} name={index} style="cursor:pointer">
                                            </lightning-icon>
                                        </span>
                                    </template>
                                    <template if:false={site.isAdded}>
                                        <span>
                                            <lightning-icon icon-name="action:new" alternative-text="new" size="small"
                                                onclick={addSites} name={index} style="cursor:pointer"></lightning-icon>
                                        </span>
                                    </template>
                                </div>
                                <div class="slds-col slds-size_3-of-12 slds-p-top_large">
                                    <span class="slds-text-heading_small">{site.billingSite.Name}</span>
                                </div>
                                <div class="slds-col slds-size_2-of-12 slds-p-top_large">
                                    <b>Site Id:&nbsp;</b>
                                    <span class="slds-text-heading_small">{site.billingSite.Site_Number__c}</span>
                                </div>
                                <div class="slds-col slds-size_2-of-12 slds-p-top_large">
                                    <b>Street:&nbsp;</b>
                                    <span class="slds-text-heading_small">{site.billingSite.BillingStreet}</span>
                                </div>
                                <div class="slds-col slds-size_2-of-12 slds-p-top_large">
                                    <b>City:&nbsp;</b>
                                    <span class="slds-text-heading_small">{site.billingSite.BillingCity}</span>
                                </div>
                                <div class="slds-col slds-size_1-of-12 slds-p-top_large">
                                    <b>State:&nbsp;</b>
                                    <span class="slds-text-heading_small">{site.billingSite.BillingState}</span>
                                </div>
                            </div>
                        </template>
                        <template if:true={isModalLoaded}>
                            <lightning-spinner alternative-text="Loading..."></lightning-spinner>
                        </template>
                        <template if:true={isSiteSearched} for:each={searchedBillingAccount} for:item="site"
                            for:index="index">
                            <div class="slds-grid slds-wrap slds-border_top" key={site.billingSite.Id}>
                                <div class="slds-col slds-size_1-of-12 slds-p-top_small">
                                    <template if:true={site.isAdded}>
                                        <span>
                                            <lightning-icon icon-name="action:approval" alternative-text="approve"
                                                size="small" onclick={addSites} name={index} style="cursor:pointer">
                                            </lightning-icon>
                                        </span>
                                    </template>
                                    <template if:false={site.isAdded}>
                                        <span>
                                            <lightning-icon icon-name="action:new" alternative-text="new" size="small"
                                                onclick={addSites} name={index} style="cursor:pointer"></lightning-icon>
                                        </span>
                                    </template>
                                </div>
                                <div class="slds-col slds-size_3-of-12 slds-p-top_large">
                                    <span class="slds-text-heading_small">{site.billingSite.Name}</span>
                                </div>
                                <div class="slds-col slds-size_2-of-12 slds-p-top_large">
                                    <b>Site ID:&nbsp;</b>
                                    <span class="slds-text-heading_small">{site.billingSite.Site_Number__c}</span>
                                </div>
                                <div class="slds-col slds-size_2-of-12 slds-p-top_large">
                                    <b>Street:&nbsp;</b>
                                    <span class="slds-text-heading_small">{site.billingSite.BillingStreet}</span>
                                </div>
                                <div class="slds-col slds-size_2-of-12 slds-p-top_large">
                                    <b>City:&nbsp;</b>
                                    <span class="slds-text-heading_small">{site.billingSite.BillingCity}</span>
                                </div>
                                <div class="slds-col slds-size_1-of-12 slds-p-top_large">
                                    <b>State:&nbsp;</b>
                                    <span class="slds-text-heading_small">{site.billingSite.BillingState}</span>
                                </div>
                            </div>
                        </template>
                          
                        <template if:true={isModalLoaded}>
                            <lightning-spinner alternative-text="Loading..."></lightning-spinner>
                        </template>
                    </div>
                    
                    <footer class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral" onclick={closeModel}>Cancel</button>
                        <!--<button class="slds-button slds-button_neutral" onclick={handlePrevious}>Previous</button>-->
                        <!--<button class="slds-button slds-button_brand" onclick={handleSendApplication}>Send Application</button>-->
                        <template if:true={ToggleContactDetail}>
                            <button class="slds-button slds-button_brand" onclick={handleReview}>Next</button>
                        </template>
                        <template if:false={ToggleContactDetail}>
                            <button class="slds-button slds-button_brand" disabled="">Next</button>
                        </template>
                    
                    </footer>
                </div>
                
                    
                
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </template>
        
                
    
         
    </template>
    
     
    
    <template if:true={showReviewPage}>
        <template if:true={showModel}>
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                            onclick={closeModel} title="Close">
                            <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#close"></use>
                            </svg>
                            <!--<span class="slds-assist ive-text">Close</span>-->
                        </button>
                        <template if:true={totalSites}>
                            <h2 id="modal-heading-03"
                                class="slds-modal__title slds-hyphenate slds-text-heading_medium slds-text-color_success">
                                Total Number of Selected Sites : {totalSelectedSites}</h2>
                        </template>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-2">
                        <h2 class="slds-text-heading_medium slds-text-color_success">Please Review selected sites :</h2>
                        <p class="slds-icon-text-success " style="color: rgb(50, 112, 65)">
                            <b>
                                <lightning-icon icon-name="utility:light_bulb" size="x-small" class="green_Icon">
                                    alternative-text="Indicates approval"></lightning-icon>
                                You can de-select sites to remove sites and use previous button to add new Site again :
                            </b>
                        </p>
                        <template for:each={addedNewSites} for:item="site" for:index="index">
                            <div class="slds-grid slds-wrap slds-border_top" key={site.billingSite.Id}>
                                <div class="slds-col slds-size_1-of-12 slds-p-top_small">
                                    <template if:true={site.isAdded}>
                                        <span>
                                            <lightning-icon icon-name="action:approval" alternative-text="approve"
                                                size="small" onclick={addSites} name={index} style="cursor:pointer">
                                            </lightning-icon>
                                        </span>
                                    </template>
                                    <template if:false={site.isAdded}>
                                        <span>
                                            <lightning-icon icon-name="action:new" alternative-text="new" size="small"
                                                onclick={addSites} name={index} style="cursor:pointer"></lightning-icon>
                                        </span>
                                    </template>
                                </div>
                                <div class="slds-col slds-size_3-of-12 slds-p-top_large">
                                    <span class="slds-text-heading_small">{site.billingSite.Name}</span>
                                </div>
                                <div class="slds-col slds-size_2-of-12 slds-p-top_large">
                                    <b>Site Id:&nbsp;</b>
                                    <span class="slds-text-heading_small">{site.billingSite.Site_Number__c}</span>
                                </div>
                                <div class="slds-col slds-size_2-of-12 slds-p-top_large">
                                    <b>Street:&nbsp;</b>
                                    <span class="slds-text-heading_small">{site.billingSite.BillingStreet}</span> 
                                </div>
                                <div class="slds-col slds-size_2-of-12 slds-p-top_large">
                                    <b>City:&nbsp;</b>
                                    <span class="slds-text-heading_small">{site.billingSite.BillingCity}</span>
                                </div>
                                <div class="slds-col slds-size_1-of-12 slds-p-top_large">
                                    <b>State:&nbsp;</b>
                                    <span class="slds-text-heading_small">{site.billingSite.BillingState}</span>
                                </div>
                            </div>
                        </template>
                        <template if:true={isModalLoaded}>
                            <lightning-spinner alternative-text="Loading..."></lightning-spinner>
                        </template>
                        <template if:true={isModalLoaded}>
                            <lightning-spinner alternative-text="Loading..."></lightning-spinner>
                        </template>
                    </div>
                    <footer class="slds-modal__footer">
                        <!--<button class="slds-button slds-button_neutral" onclick={closeModel}>Cancel</button>-->
                        <button class="slds-button slds-button_neutral" onclick={handlePrevious}>Previous</button>
                        <button  class="slds-button slds-button_brand" onclick={handleSendApplication}>Send
                            Application</button>
                        <!--<button class="slds-button slds-button_brand" onclick={handleReview}>Next2</button>-->
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </template>
    </template>
</template>