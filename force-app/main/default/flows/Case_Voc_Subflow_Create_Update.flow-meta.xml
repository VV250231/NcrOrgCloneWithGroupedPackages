<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Send email to all queue member of a queue when queue is owner of child case(Follow-up) Owner ID starts With(&apos;00G&apos;).</description>
        <name>Notify_all_queue_member_when_queue_is_owner_of_child_case</name>
        <label>Notify all queue member when queue is owner of child case</label>
        <locationX>50</locationX>
        <locationY>518</locationY>
        <actionName>Case.member_of_a_queue</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Check_If_child_case_is_escalated</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>CaseNew.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <description>Send Email to Case Owner and His/her Manager.</description>
        <name>Notify_case_owner_and_his_her_manager</name>
        <label>Notify case owner and his/her manager</label>
        <locationX>930</locationX>
        <locationY>758</locationY>
        <actionName>Case.Notification_to_Case_Owner_and_his_her_manager1</actionName>
        <actionType>emailAlert</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>CaseNew.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <description>Send email to child case owner ,queue member and Account team member having CSM role.</description>
        <name>Notify_case_owner_queue_member_csm_account_team_member_on_child_case_escalated</name>
        <label>Notify case owner/queue member/csm account team member on child case escalated</label>
        <locationX>402</locationX>
        <locationY>950</locationY>
        <actionName>Case.Email_Child_Case_Owner_Quue_Member_and_Account_Member</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Check_case_status</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>CaseNew.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <description>Send Email to Child Case owner and CSM on Account team.</description>
        <name>Notify_Child_Case_owner_and_Account_team_CSM_User</name>
        <label>Notify Child Case owner and Account team CSM User</label>
        <locationX>402</locationX>
        <locationY>1286</locationY>
        <actionName>Case.Notify_Child_Case_owner_and_Account_team_CSM_User</actionName>
        <actionType>emailAlert</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>CaseNew.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <description>Send Email to Owner of Child Case(Follow-up) Owner id start with &apos;005&apos;.</description>
        <name>Notify_child_case_owner_when_user_is_owner_of_child_case</name>
        <label>Notify child case owner when user is owner of child case</label>
        <locationX>314</locationX>
        <locationY>518</locationY>
        <actionName>Case.email_to_Child_Case_Owner_for_Reassignment</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Check_If_child_case_is_escalated</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>CaseNew.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <description>Send email to Parent(Close The Loop) Case Owner and CSM on case Close.</description>
        <name>Notify_parent_case_owner_and_account_team_having_csm_role_on_case_status_close</name>
        <label>Notify parent case owner and account team having csm role on case status close</label>
        <locationX>1458</locationX>
        <locationY>518</locationY>
        <actionName>Case.Email_to_Parent_Case_owner_and_CSM_User</actionName>
        <actionType>emailAlert</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>CaseNew.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <apiVersion>53.0</apiVersion>
    <decisions>
        <name>Check_case_record_type</name>
        <label>Check case record type</label>
        <locationX>1392</locationX>
        <locationY>158</locationY>
        <defaultConnectorLabel>Else</defaultConnectorLabel>
        <rules>
            <name>If_Follow_up</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CaseNew.RecordType.Name</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>FollowUpRecordType</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Check_child_case_email_notification_condition</targetReference>
            </connector>
            <label>If Follow-up</label>
        </rules>
        <rules>
            <name>If_Close_the_Loop</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CaseNew.RecordType.Name</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>CloseTheLoop</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Checking_case_status</targetReference>
            </connector>
            <label>If Close the Loop</label>
        </rules>
    </decisions>
    <decisions>
        <description>If case status is other than close, then an email will be triggered for child case owner and account team having csm role.</description>
        <name>Check_case_status</name>
        <label>Check case status</label>
        <locationX>534</locationX>
        <locationY>1166</locationY>
        <defaultConnectorLabel>Else</defaultConnectorLabel>
        <rules>
            <name>Case_status_not_equal_to_close</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CaseNew.ParentId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseNew.Due_Date__c</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <elementReference>$Flow.CurrentDateTime</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseOld.Is_Due_Date_Passed__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>CaseNew.Is_Due_Date_Passed__c</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseNew.Is_Due_Date_Passed__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseNew.Status</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Closed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Notify_Child_Case_owner_and_Account_team_CSM_User</targetReference>
            </connector>
            <label>Case status not equal to close</label>
        </rules>
    </decisions>
    <decisions>
        <description>Checking the required condition to notify all queue member or user when they are the owner of child case.</description>
        <name>Check_child_case_email_notification_condition</name>
        <label>Check child case email notification conditions</label>
        <locationX>534</locationX>
        <locationY>278</locationY>
        <defaultConnector>
            <targetReference>Check_If_child_case_is_escalated</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Else</defaultConnectorLabel>
        <rules>
            <name>If_True</name>
            <conditionLogic>(1 OR 2 ) AND (3 OR 4 OR 5 ) AND 6</conditionLogic>
            <conditions>
                <leftValueReference>CaseOld.OwnerId</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>CaseNew.OwnerId</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseOld</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseNew.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Detractor</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseNew.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Immediate</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseNew.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Immediate Detractor</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseNew.ParentId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Check_the_owner_of_the_child_case</targetReference>
            </connector>
            <label>If True</label>
        </rules>
    </decisions>
    <decisions>
        <description>Checking required condition to check child case is escalated or not, if escalated then an email notification will trigger for the case owner/queue member/csm account team member.</description>
        <name>Check_If_child_case_is_escalated</name>
        <label>Check If child case is escalated</label>
        <locationX>534</locationX>
        <locationY>830</locationY>
        <defaultConnector>
            <targetReference>Check_case_status</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Else</defaultConnectorLabel>
        <rules>
            <name>If_True1</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CaseNew.Child_Case_Escalated_Date__c</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <elementReference>$Flow.CurrentDateTime</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseOld.Is_Child_Case_Escalated__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>CaseNew.Is_Child_Case_Escalated__c</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseNew.Is_Child_Case_Escalated__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Notify_case_owner_queue_member_csm_account_team_member_on_child_case_escalated</targetReference>
            </connector>
            <label>If True</label>
        </rules>
    </decisions>
    <decisions>
        <description>Here we are checking the owner of child case, whether it is queue or a user.</description>
        <name>Check_the_owner_of_the_child_case</name>
        <label>Check the owner of the child case</label>
        <locationX>314</locationX>
        <locationY>398</locationY>
        <defaultConnector>
            <targetReference>Check_If_child_case_is_escalated</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Else</defaultConnectorLabel>
        <rules>
            <name>If_Queue_is_the_owner</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CaseNew.OwnerId</leftValueReference>
                <operator>StartsWith</operator>
                <rightValue>
                    <stringValue>00G</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Notify_all_queue_member_when_queue_is_owner_of_child_case</targetReference>
            </connector>
            <label>If Queue is the owner</label>
        </rules>
        <rules>
            <name>If_User_is_the_owner</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CaseNew.OwnerId</leftValueReference>
                <operator>StartsWith</operator>
                <rightValue>
                    <stringValue>005</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Notify_child_case_owner_when_user_is_owner_of_child_case</targetReference>
            </connector>
            <label>If User is the owner</label>
        </rules>
    </decisions>
    <decisions>
        <name>Checking_case_status</name>
        <label>Checking case status</label>
        <locationX>1524</locationX>
        <locationY>278</locationY>
        <defaultConnectorLabel>Else</defaultConnectorLabel>
        <rules>
            <name>If_status_is_new</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CaseNew.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>New</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseNew.OwnerId</leftValueReference>
                <operator>StartsWith</operator>
                <rightValue>
                    <stringValue>005</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Checking_condition_required_to_notify_case_owner_and_his_her_manager</targetReference>
            </connector>
            <label>If status is new</label>
        </rules>
        <rules>
            <name>If_status_is_closed</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CaseNew.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Closed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Checking_case_type</targetReference>
            </connector>
            <label>If status is closed</label>
        </rules>
    </decisions>
    <decisions>
        <name>Checking_case_type</name>
        <label>Checking case type</label>
        <locationX>1590</locationX>
        <locationY>398</locationY>
        <defaultConnectorLabel>Else</defaultConnectorLabel>
        <rules>
            <name>If_Immediate_Detractor_Immediate_Detractor</name>
            <conditionLogic>(1 OR 2 OR 3) AND 4</conditionLogic>
            <conditions>
                <leftValueReference>CaseNew.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Immediate</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseNew.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Detractor</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseNew.Type</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Immediate Detractor</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseOld.Status</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>CaseNew.Status</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Notify_parent_case_owner_and_account_team_having_csm_role_on_case_status_close</targetReference>
            </connector>
            <label>If Immediate/Detractor/Immediate Detractor</label>
        </rules>
    </decisions>
    <decisions>
        <name>Checking_condition_required_to_notify_case_owner_and_his_her_manager</name>
        <label>Checking condition required to notify case owner and his/her manager</label>
        <locationX>1062</locationX>
        <locationY>398</locationY>
        <defaultConnectorLabel>Else</defaultConnectorLabel>
        <rules>
            <name>If_True2</name>
            <conditionLogic>( 1 AND ( ( 2 AND 3 ) OR ( 4 AND 5 ) ) ) OR ( 6 AND 7 AND 8 )</conditionLogic>
            <conditions>
                <leftValueReference>CaseNew.Immediate_Detractor_Case_Escalated_Date__c</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <elementReference>$Flow.CurrentDateTime</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseOld.Immediate_Detractor_Case_Escalated__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseNew.Immediate_Detractor_Case_Escalated__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseOld.Immediate_Case_Escalated__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseNew.Immediate_Case_Escalated__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseNew.Detractor_Case_Escalated_Date__c</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <elementReference>$Flow.CurrentDateTime</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseOld.Detractor_Case_Escalated__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CaseNew.Detractor_Case_Escalated__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_case_owner_manager_details</targetReference>
            </connector>
            <label>If True</label>
        </rules>
    </decisions>
    <description>This sub-flow is sending notification via email for the VOC case survey.
Following workflows are migrated to this flow:
1. Notify all queue member when queue is owner of child case
2. Notify child case owner when user is owner of child case
3. Notify case owner/queue member/csm account team member on child case escalated
4. Notify case owner and his/her manager
5. Notify child case owner and account team having csm role on case status other than close
6. Notify parent case owner and account team having csm role on case status close</description>
    <interviewLabel>Case Voc {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Case Voc - Subflow Create/Update</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_case_owner_manager_details</name>
        <label>Get case owner manager details</label>
        <locationX>930</locationX>
        <locationY>518</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Updating_CaseOwnerManagerEmailVoc_field</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>CaseNew.Owner:User.ManagerId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>User</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Updating_CaseOwnerManagerEmailVoc_field</name>
        <label>Updating CaseOwnerManagerEmailVoc field</label>
        <locationX>930</locationX>
        <locationY>638</locationY>
        <connector>
            <targetReference>Notify_case_owner_and_his_her_manager</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>CaseNew.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>CaseOwnerManagerEmailVoc__c</field>
            <value>
                <elementReference>Get_case_owner_manager_details.Email</elementReference>
            </value>
        </inputAssignments>
        <object>Case</object>
    </recordUpdates>
    <start>
        <locationX>1266</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Check_case_record_type</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <description>This variable contains case record after insert or after update.</description>
        <name>CaseNew</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Case</objectType>
    </variables>
    <variables>
        <description>This variable contains case record before insert or before update.</description>
        <name>CaseOld</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Case</objectType>
    </variables>
    <variables>
        <description>This variable contains the name of Close the loop record type present on the case object.</description>
        <name>CloseTheLoop</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue>Close the Loop</stringValue>
        </value>
    </variables>
    <variables>
        <description>This variable contains the name of follow-up record type present on the case object.</description>
        <name>FollowUpRecordType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue>Follow-up</stringValue>
        </value>
    </variables>
</Flow>
