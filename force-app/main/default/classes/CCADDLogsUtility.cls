public class CCADDLogsUtility {
    public static void insertCCADDLogs(String req,String res,String status,String caseNumber,String ccadDisputeNbr, String reqType){
        if(String.isBlank(caseNumber)) caseNumber = '';
        Dispute_Integration_Logs__c log = new Dispute_Integration_Logs__c(Name='CCAD_'+caseNumber+'_'+reqType,Request__c=req,Response__c=res,Status__c=status,caseNumber__c=caseNumber,CCAD_Dispute_Nbr__c = ccadDisputeNbr, RequestType__c=reqType);
    	Database.SaveResult result =Database.insert(log,false);
        if(!result.isSuccess()){
       		Dispute_Integration_Logs__c logTryAgain = new Dispute_Integration_Logs__c(Name='CCAD_'+caseNumber+'_'+reqType,Request__c=req,Response__c=res,Status__c=status,caseNumber__c=caseNumber,CCAD_Dispute_Nbr__c = ccadDisputeNbr, RequestType__c=reqType);
    		Database.SaveResult finResult = Database.insert(logTryAgain,false);  
            if(!finResult.isSuccess()){
                Messaging.SingleEmailMessage semail = new Messaging.SingleEmailMessage();
                String[] sendingTo = new String[]{'NI230017@ncr.com'};
                semail.setToAddresses(sendingTo); 
                semail.setSubject('CCADD - Integration Logging Error'); 
                String body ='<!doctype html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><link href="http://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet" type="text/css"><link href="http://fonts.googleapis.com/css?family=Raleway:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" type="text/css"><style type="text/css">a {color: #54b948;}body {font-family: "Open Sans",  Arial, sans-serif;}.auto-style1 {font-family: Raleway, Arial, Helvetica, sans-serif;font-weight: 900;font-size: 46px; 	color: #FFFFFF; text-transform: normal; letter-spacing: 3px;} .auto-style4 {color: #1D1D1D; }.auto-style5 {font-family: Open Sans, Arial, Helvetica, sans-serif;font-size: 14px;line-height: 20px;color: #1D1D1D;margin-right: 15px;} </style> </head> <body><table border="0" cellpadding="0" cellspacing="0" width="655" align="center"><tbody><tr><td><table border="0" cellspacing="0" cellpadding="0" bgcolor="#ED9A22" style="width: 665px; height: 149px;"><tr><td width="655"><table border="0" cellspacing="0" cellpadding="0"><tr><td bgcolor="#ED9A22" align="right" width="30" height="43"></td><td bgcolor="#ED9A22" height="43"></td> <td bgcolor="#ED9A22" align="left" width="25" height="43"></td></tr><tr><td bgcolor="#ED9A22" align="right" width="30"></td><td bgcolor="#ED9A22"><p style="padding:0; margin:0;" align="left" class="auto-style1">CCADD Integration Logging Error<br></p></td><td bgcolor="#ED9A22" align="left" width="25"></td></tr><tr><td bgcolor="#ED9A22" align="right" width="30" height="43"></td><td bgcolor="#ED9A22" height="43"></td><td bgcolor="#ED9A22" align="left" width="25" height="43"></td></tr></table></td></tr><tr valign="bottom"> </tr></table></td></tr></tbody></table><br><table border="0" align="center" bgcolor="#FFFFFF" style="width: 665px"></table><table border="0" align="center" bgcolor="#FFFFFF" style="width: 665px">  <tr valign="top"><td><p style="font-family: Open Sans, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 20px; margin-right: 15px;" class="auto-style4">Please find the details of CCADD Integration logging failed.</p>  <ul style="font-family: Open Sans, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 20px; color: #1d1d1d; margin-right: 15px;"> 	<li>Case Number : '+caseNumber+'</li><li>Request : '+req+'</li><li>Response : '+res+'</li><li>Status : '+status+'</li><li>Request Type : '+reqType+'</li> </ul> 		<p style="font-family: Open Sans, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 20px; margin-right: 15px;" class="auto-style4">Warmest regards,</p><p class="auto-style5"><strong><span class="auto-style4">Salesforce Admin and Support</strong></p></td>     </tr>   </table>    <!--END OF SECTION CONTENT-->    <br/> <!--FOOTER GRAPHICS AND CONTENT -->   <table border="0" cellpadding="0" cellspacing="0" align="center" bgcolor="#f1f2f2" style="width: 665px">     <tbody>       <tr>         <td><table width="656" border="0" cellspacing="0" cellpadding="0"><tr>             <td width="565"><table width="565" border="0" cellspacing="0" cellpadding="0">               <tr> 		<td bgcolor="#f1f2f2" style="padding-left:25px;"><span style="font-family: Open Sans, Arial, Helvetica, sans-serif; font-size: 13px; color: #58595b;"></span></td></tr><tr><td bgcolor="#f1f2f2" style="padding-top: 10px; padding-bottom: 20px; padding-left: 10px;"><span style="font-family: Open Sans, Arial, Helvetica, sans-serif; font-size: 13px; " class="auto-style4">NCR Confidential. FOR INTERNAL USE ONLY.<br/>NCR Corporation 864 Spring St. NW, Atlanta, GA 30308-1007<br/>©2020 NCR Corporation. All rights reserved. </span><span style="font-family: "Open Sans", Arial, Helvetica, sans-serif; font-size: 13px; color: #1d1d1d;"><a href="http://www.ncr.com?elqTrackId=f9a8c9ac8ee64584a5fe2fa3a7d92f50&elqTrack=true" target="_blank"><span class="auto-style4">ncr.com</span></a></span><span style="font-family: Open Sans, Arial, Helvetica, sans-serif; font-size: 13px; "><br class="auto-style4"></span><span style="font-family:Open Sans, Arial, Helvetica, sans-serif; font-size: 13px; color: #1d1d1d;"><span style="font-family: Open Sans, Arial, Helvetica, sans-serif; font-size: 13px; ">NCR respects</span> <a href="http://www.ncr.com/home/privacy-policy" style="color: #54b948;" target="_blank">your privacy</a>.</span><br><br><table width="168" border="0" cellspacing="" cellpadding="0"><tr><td><a href="http://on.fb.me/k7ehst"><img alt="facebook" border="0" hspace="0" src="http://ncrpr.ncr.com/web/RsdMkt/emailCampaigns/templates/internalComms/images/img-icon-fbGreen.png" style="margin-right: 5px;"></a></td><td><a href="http://bit.ly/ncrtwit"><img alt="twitter" border="0" src="http://ncrpr.ncr.com/web/RsdMkt/emailCampaigns/templates/internalComms/images/img-icon-twtGreen.png" style="padding-right:5px"></a></td><td><a href="http://co.ncr.com/15RlQKy"><img alt="linkedin" border="0" src="http://ncrpr.ncr.com/web/RsdMkt/emailCampaigns/templates/internalComms/images/img-icon-linkedinGreen.png" style="padding-right: 5px;"></a></td><td><a href="http://bit.ly/kh0jQU"><img alt="youtube" border="0" src="http://ncrpr.ncr.com/web/RsdMkt/emailCampaigns/templates/internalComms/images/img-icon-ytGreen.png" style="padding-right:5px"></a></td><td><a href="http://co.ncr.com/11klyVo"><img alt="rss" border="0" src="http://ncrpr.ncr.com/web/RsdMkt/emailCampaigns/templates/internalComms/images/img-icon-rssGreen.png" style="padding-right:5px"></a></td><td><a href="https://co.ncr.com/2Ia1pTc"><img src="http://ncrpr.ncr.com/web/RsdMkt/emailCampaigns/templates/internalComms/images/img-icon-igGreen.png" alt="instagram" border="0"></a></td></tr></table></td></tr><tr><td valign="bottom">&nbsp;</td></tr></table></td><td width="91" valign="bottom"><img src="http://www.ncr.com/web/RsdMkt/emailCampaigns/templates/internalComms/images/NCR-block-border.png" width="100" height="100"/></td></tr></table></td></tr></tbody></table></body></html> ';
                semail.setHtmlBody(body);
                Messaging.sendEmail(new Messaging.SingleEmailMessage[] {semail}); 
            }
        }
    	//return log;
    }
    
    
     public static void insertDisputeLogs(String transId, String req, String res, String status, String dspNbr, String reqType) {
    	insertDisputeLogs(transId, req, res, status, dspNbr,NULL,reqType);   
    	//return log;
    }
    
     @future
     public static void insertDisputeLogs(String transId, String req, String res, String status, String dspNbr,  String caseNbr,String reqType) {        
         if(String.isNotBlank(res) && res.length() > 131070) {
         	res = res.substring(0, 131070);   
         }
         Dispute_Integration_Logs__c log = new Dispute_Integration_Logs__c(Name= reqType + '_' + Datetime.now().format('yyyy-MM-dd HH:mm:ss', 'America/New_York'),Request__c=req,Response__c=res,Status__c=status, Transaction_Id__c =transId, CCAD_Dispute_Nbr__c=dspNbr, caseNumber__c =caseNbr, RequestType__c=reqType);
    	Database.SaveResult result =Database.insert(log,false);
        
        if(!result.isSuccess()){
       		Dispute_Integration_Logs__c logTryAgain = new Dispute_Integration_Logs__c(Name= reqType + '_' + Datetime.now().format('yyyy-MM-dd HH:mm:ss', 'America/New_York'),Request__c=req,Response__c=res,Status__c=status, Transaction_Id__c =transId, CCAD_Dispute_Nbr__c=dspNbr,  caseNumber__c =caseNbr, RequestType__c=reqType);
    		Database.SaveResult finResult = Database.insert(logTryAgain,false);  
            if(!finResult.isSuccess()){
                Messaging.SingleEmailMessage semail = new Messaging.SingleEmailMessage();
                String[] sendingTo = new String[]{'NI230017@ncr.com', 'pb185126@ncr.com'};
                semail.setToAddresses(sendingTo); 
                semail.setSubject('CCADD - Integration Logging Error'); 
                String body ='<!doctype html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><link href="http://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet" type="text/css"><link href="http://fonts.googleapis.com/css?family=Raleway:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" type="text/css"><style type="text/css">a {color: #54b948;}body {font-family: "Open Sans",  Arial, sans-serif;}.auto-style1 {font-family: Raleway, Arial, Helvetica, sans-serif;font-weight: 900;font-size: 46px; 	color: #FFFFFF; text-transform: normal; letter-spacing: 3px;} .auto-style4 {color: #1D1D1D; }.auto-style5 {font-family: Open Sans, Arial, Helvetica, sans-serif;font-size: 14px;line-height: 20px;color: #1D1D1D;margin-right: 15px;} </style> </head> <body><table border="0" cellpadding="0" cellspacing="0" width="655" align="center"><tbody><tr><td><table border="0" cellspacing="0" cellpadding="0" bgcolor="#ED9A22" style="width: 665px; height: 149px;"><tr><td width="655"><table border="0" cellspacing="0" cellpadding="0"><tr><td bgcolor="#ED9A22" align="right" width="30" height="43"></td><td bgcolor="#ED9A22" height="43"></td> <td bgcolor="#ED9A22" align="left" width="25" height="43"></td></tr><tr><td bgcolor="#ED9A22" align="right" width="30"></td><td bgcolor="#ED9A22"><p style="padding:0; margin:0;" align="left" class="auto-style1">CCADD Integration Logging Error<br></p></td><td bgcolor="#ED9A22" align="left" width="25"></td></tr><tr><td bgcolor="#ED9A22" align="right" width="30" height="43"></td><td bgcolor="#ED9A22" height="43"></td><td bgcolor="#ED9A22" align="left" width="25" height="43"></td></tr></table></td></tr><tr valign="bottom"> </tr></table></td></tr></tbody></table><br><table border="0" align="center" bgcolor="#FFFFFF" style="width: 665px"></table><table border="0" align="center" bgcolor="#FFFFFF" style="width: 665px">  <tr valign="top"><td><p style="font-family: Open Sans, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 20px; margin-right: 15px;" class="auto-style4">Please find the details of CCADD Integration logging failed.</p>  <ul style="font-family: Open Sans, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 20px; color: #1d1d1d; margin-right: 15px;"> 	<li>Dispute Number : '+ dspNbr +'</li><li>Request : '+req+'</li><li>Response : '+res+'</li><li>Status : '+status+'</li><li>Request Type : '+reqType+'</li> </ul> 		<p style="font-family: Open Sans, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 20px; margin-right: 15px;" class="auto-style4">Warmest regards,</p><p class="auto-style5"><strong><span class="auto-style4">Salesforce Admin and Support</strong></p></td>     </tr>   </table>    <!--END OF SECTION CONTENT-->    <br/> <!--FOOTER GRAPHICS AND CONTENT -->   <table border="0" cellpadding="0" cellspacing="0" align="center" bgcolor="#f1f2f2" style="width: 665px">     <tbody>       <tr>         <td><table width="656" border="0" cellspacing="0" cellpadding="0"><tr>             <td width="565"><table width="565" border="0" cellspacing="0" cellpadding="0">               <tr> 		<td bgcolor="#f1f2f2" style="padding-left:25px;"><span style="font-family: Open Sans, Arial, Helvetica, sans-serif; font-size: 13px; color: #58595b;"></span></td></tr><tr><td bgcolor="#f1f2f2" style="padding-top: 10px; padding-bottom: 20px; padding-left: 10px;"><span style="font-family: Open Sans, Arial, Helvetica, sans-serif; font-size: 13px; " class="auto-style4">NCR Confidential. FOR INTERNAL USE ONLY.<br/>NCR Corporation 864 Spring St. NW, Atlanta, GA 30308-1007<br/>©2020 NCR Corporation. All rights reserved. </span><span style="font-family: "Open Sans", Arial, Helvetica, sans-serif; font-size: 13px; color: #1d1d1d;"><a href="http://www.ncr.com?elqTrackId=f9a8c9ac8ee64584a5fe2fa3a7d92f50&elqTrack=true" target="_blank"><span class="auto-style4">ncr.com</span></a></span><span style="font-family: Open Sans, Arial, Helvetica, sans-serif; font-size: 13px; "><br class="auto-style4"></span><span style="font-family:Open Sans, Arial, Helvetica, sans-serif; font-size: 13px; color: #1d1d1d;"><span style="font-family: Open Sans, Arial, Helvetica, sans-serif; font-size: 13px; ">NCR respects</span> <a href="http://www.ncr.com/home/privacy-policy" style="color: #54b948;" target="_blank">your privacy</a>.</span><br><br><table width="168" border="0" cellspacing="" cellpadding="0"><tr><td><a href="http://on.fb.me/k7ehst"><img alt="facebook" border="0" hspace="0" src="http://ncrpr.ncr.com/web/RsdMkt/emailCampaigns/templates/internalComms/images/img-icon-fbGreen.png" style="margin-right: 5px;"></a></td><td><a href="http://bit.ly/ncrtwit"><img alt="twitter" border="0" src="http://ncrpr.ncr.com/web/RsdMkt/emailCampaigns/templates/internalComms/images/img-icon-twtGreen.png" style="padding-right:5px"></a></td><td><a href="http://co.ncr.com/15RlQKy"><img alt="linkedin" border="0" src="http://ncrpr.ncr.com/web/RsdMkt/emailCampaigns/templates/internalComms/images/img-icon-linkedinGreen.png" style="padding-right: 5px;"></a></td><td><a href="http://bit.ly/kh0jQU"><img alt="youtube" border="0" src="http://ncrpr.ncr.com/web/RsdMkt/emailCampaigns/templates/internalComms/images/img-icon-ytGreen.png" style="padding-right:5px"></a></td><td><a href="http://co.ncr.com/11klyVo"><img alt="rss" border="0" src="http://ncrpr.ncr.com/web/RsdMkt/emailCampaigns/templates/internalComms/images/img-icon-rssGreen.png" style="padding-right:5px"></a></td><td><a href="https://co.ncr.com/2Ia1pTc"><img src="http://ncrpr.ncr.com/web/RsdMkt/emailCampaigns/templates/internalComms/images/img-icon-igGreen.png" alt="instagram" border="0"></a></td></tr></table></td></tr><tr><td valign="bottom">&nbsp;</td></tr></table></td><td width="91" valign="bottom"><img src="http://www.ncr.com/web/RsdMkt/emailCampaigns/templates/internalComms/images/NCR-block-border.png" width="100" height="100"/></td></tr></table></td></tr></tbody></table></body></html> ';
                semail.setHtmlBody(body);
                Messaging.sendEmail(new Messaging.SingleEmailMessage[] {semail}); 
            }
        }    
     }
}